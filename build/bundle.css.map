{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte",
    "../../FileInput.svelte",
    "../../Loading.svelte",
    "../../button.svelte",
    "../../controls.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import Controls from \"./components/controls/controls.svelte\";\n  import FileInput from \"./components/FileInput.svelte\";\n  import Loading from \"./components/Loading.svelte\";\n\n  import { onMount } from \"svelte\";\n  import { loadFile } from \"./reader/loader\";\n  import { readContentDOM, lookBackward, lookForward } from \"./reader/reader\";\n  import { getAudioSource } from \"./reader/audio\";\n  import { autoscroll } from \"./utils/autoscroll\";\n\n  let content = \"\";\n  let zip;\n  let ref;\n  let cursor;\n  let audioRef;\n  let walker;\n  let playing = false;\n  let loading = false;\n  let cache = {};\n\n  onMount(() => {\n    if (\"serviceWorker\" in navigator) {\n      if (__dev__) {\n        navigator.serviceWorker.getRegistrations().then(regs => {\n          if (regs.length) {\n            regs.forEach(reg => reg.unregister());\n          }\n        });\n      } else {\n        navigator.serviceWorker.register(\"/service-worker.js\");\n      }\n    }\n  });\n\n  const loadDocument = async event => {\n    try {\n      const [file] = event.target.files;\n\n      if (!file.name.match(/\\.zip$/)) {\n        return Promise.reject(\"File must be in .zip format.\");\n      }\n\n      loading = true;\n\n      const result = await loadFile(file);\n\n      content = result.dom.parentElement.innerHTML;\n      zip = result.zip;\n    } catch (error) {\n      console.warn(error);\n    } finally {\n      loading = false;\n    }\n  };\n\n  const stopPlayback = () => {\n    walker.return();\n    audioRef.pause();\n    cursor.classList.remove(\"active\");\n  };\n\n  /**\n   *\n   * @param {string} audio\n   * @param {Element} element\n   * @returns {Promise<void>}\n   */\n  function playAudio(audio, element) {\n    return new Promise(async resolve => {\n      try {\n        audioRef.src = audio;\n\n        const onCompleted = () => {\n          audioRef.pause();\n          audioRef.removeEventListener(\"pause\", onCompleted);\n          element.classList.remove(\"active\");\n\n          return resolve();\n        };\n\n        const onStart = async () => {\n          audioRef.addEventListener(\"pause\", onCompleted);\n          audioRef.removeEventListener(\"canplaythrough\", onStart);\n          element.classList.add(\"active\");\n\n          audioRef.play();\n        };\n\n        audioRef.addEventListener(\"canplaythrough\", onStart);\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    });\n  }\n\n  const readDocument = async () => {\n    walker = readContentDOM(cursor);\n\n    const getAudioUrl = getAudioSource(zip, cache);\n\n    for (const element of walker) {\n      const audioUrl = await getAudioUrl(element);\n\n      if (audioUrl) {\n        cursor = element;\n\n        if (element.offsetHeight) {\n          autoscroll(element);\n        }\n\n        await playAudio(audioUrl, element);\n      }\n    }\n  };\n\n  const onContentSelect = event => {\n    if (playing) {\n      stopPlayback();\n    }\n\n    cursor = event.target;\n    playing = true;\n    readDocument();\n  };\n\n  const onDocumentLoad = () => {\n    if (ref && ref.children.length) {\n      cursor = ref;\n    }\n  };\n\n  async function loadExample() {\n    try {\n      loading = true;\n      const res = await fetch(\n        \"https://cors-anywhere.herokuapp.com/https://dl.daisy.org/samples/3full-text-full-audio/are-you-ready-z3986.zip\",\n        {\n          method: \"GET\",\n          mode: \"cors\"\n        }\n      );\n      const data = await res.blob();\n\n      const result = await loadFile(data);\n\n      content = result.dom.parentElement.innerHTML;\n      zip = result.zip;\n    } catch (error) {\n      console.warn(error);\n    } finally {\n      loading = false;\n    }\n  }\n\n  const togglePlay = () => {\n    if (playing) {\n      stopPlayback();\n    } else {\n      readDocument();\n    }\n\n    playing = !playing;\n  };\n\n  const controlHandler = handler => () => {\n    const element = handler(cursor);\n\n    if (element) {\n      if (playing) {\n        stopPlayback();\n      }\n\n      playing = true;\n      cursor = element;\n      readDocument();\n    }\n  };\n\n  const handlePrevious = controlHandler(lookBackward);\n\n  const handleForward = controlHandler(lookForward);\n\n  // Keyboard events\n  window.addEventListener(\"keydown\", event => {\n    if (content) {\n      switch (event.code) {\n        case \"ArrowLeft\":\n          event.preventDefault();\n          handlePrevious();\n          return;\n        case \"ArrowRight\":\n          event.preventDefault();\n          handleForward();\n          return;\n        case \"Space\":\n          event.preventDefault();\n          togglePlay();\n          return;\n        default:\n          return;\n      }\n    }\n  });\n\n  $: content, setTimeout(onDocumentLoad, 0);\n</script>\n\n<style>\n  main {\n    min-height: 100vh;\n  }\n</style>\n\n<main>\n  {#if !content}\n    <FileInput\n      on:change={loadDocument}\n      on:click={loadExample}\n      disabled={loading} />\n  {/if}\n  {#if content}\n    <section class=\"content\">\n      <div id=\"content\" bind:this={ref} on:click={onContentSelect}>\n        {@html content}\n      </div>\n    </section>\n  {/if}\n  <audio bind:this={audioRef} />\n  <Controls\n    {playing}\n    disabled={!content}\n    onPlayToggle={togglePlay}\n    onBackward={handlePrevious}\n    onForward={handleForward} />\n  {#if loading}\n    <Loading />\n  {/if}\n</main>\n",
    "<script>\n  export let disabled = false;\n\n  let dragging = false;\n\n  function handleDragging() {\n    if (!dragging) {\n      dragging = true;\n    }\n  }\n\n  function handleDragEnd() {\n    dragging = false;\n  }\n</script>\n\n<style>\n  section {\n    min-height: 100vh;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .container {\n    width: calc(100% - 2rem);\n    height: 8rem;\n    border: 1px solid #e1e1e1;\n    max-width: 24rem;\n    border-radius: 0.5rem;\n    background-color: #f9f9f9;\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 22px 16px -16px rgba(0, 0, 0, 0.05);\n  }\n\n  .container.dragging {\n    background-color: #e9e9e9;\n    border-color: #f1f1f1;\n  }\n\n  .container.disabled {\n    opacity: 0.5;\n  }\n\n  input {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    opacity: 0;\n  }\n\n  label {\n    display: block;\n  }\n\n  .separator {\n    margin-top: 1.5rem;\n    font-style: italic;\n    color: #727272;\n  }\n\n  button {\n    background-color: #3c40c6;\n    color: #fff;\n    margin-top: 1.5rem;\n    font-size: 0.825rem;\n    font-weight: bolder;\n  }\n\n  button[disabled] {\n    opacity: 0.5;\n  }\n</style>\n\n<section>\n  <div\n    class=\"container\"\n    class:dragging\n    class:disabled\n    on:dragover={handleDragging}\n    on:dragleave={handleDragEnd}\n    on:drop={handleDragEnd}>\n    <input\n      {disabled}\n      on:change\n      aria-label=\"File\"\n      type=\"file\"\n      name=\"file\"\n      id=\"file-input\"\n      accept=\"application/zip\" />\n    <label for=\"file-input\">\n      <strong>Choose a book file</strong>\n      or drag it here\n    </label>\n  </div>\n  <span aria-hidden=\"true\" class=\"separator\">or</span>\n  <button {disabled} type=\"button\" on:click>Load Example</button>\n</section>\n",
    "<style>\n  div {\n    position: fixed;\n    top: 1rem;\n    left: 1rem;\n  }\n\n  div :global(path) {\n    fill: #3c40c6;\n    stroke: #3c40c6;\n  }\n</style>\n\n<div aria-hidden=\"true\">\n  <svg\n    version=\"1.1\"\n    id=\"loader-1\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n    x=\"0px\"\n    y=\"0px\"\n    width=\"40px\"\n    height=\"40px\"\n    viewBox=\"0 0 50 50\"\n    style=\"enable-background:new 0 0 50 50;\"\n    xml:space=\"preserve\">\n    <path\n      fill=\"#000\"\n      d=\"M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z\">\n      <animateTransform\n        attributeType=\"xml\"\n        attributeName=\"transform\"\n        type=\"rotate\"\n        from=\"0 25 25\"\n        to=\"360 25 25\"\n        dur=\"0.6s\"\n        repeatCount=\"indefinite\" />\n    </path>\n  </svg>\n</div>\n",
    "<script>\n  export let disabled = false;\n  export let icon = null;\n  export let primary = false;\n  export let label = \"\";\n</script>\n\n<style>\n  button {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.725rem;\n    background: transparent;\n    margin: 0 0.75rem;\n    padding: 0;\n    height: 2.5rem;\n    width: 2.5rem;\n    border: 2px solid #3c40c6;\n    border-radius: 50%;\n  }\n\n  button :global(svg) {\n    fill: #3c40c6;\n    height: 1.25rem;\n    width: 1.25rem;\n  }\n\n  button.primary {\n    height: 3.25rem;\n    width: 3.25rem;\n    background: #3c40c6;\n  }\n\n  button.primary :global(svg) {\n    fill: #fff;\n    height: 1.5rem;\n    width: 1.5rem;\n  }\n\n  button[disabled] {\n    opacity: 0.5;\n  }\n</style>\n\n<button\n  class:primary\n  {disabled}\n  aria-disabled={disabled}\n  on:click\n  aria-label={label}\n  type=\"button\">\n  <svelte:component this={icon} aria-hidden=\"true\" />\n</button>\n",
    "<script>\n  import Button from \"./button.svelte\";\n  import PlayIcon from \"../../svg/play.svg\";\n  import PauseIcon from \"../../svg/pause.svg\";\n  import BackwardIcon from \"../../svg/step-backward.svg\";\n  import ForwardIcon from \"../../svg/skip-forward.svg\";\n\n  export let playing = false;\n  export let disabled;\n  export let onPlayToggle;\n  export let onBackward;\n  export let onForward;\n</script>\n\n<style>\n  .controls {\n    position: fixed;\n    width: 100%;\n    padding: 0.625rem 0;\n    bottom: 0;\n    background-color: rgba(255, 255, 255, 0.925);\n    border-top: 1px solid #f1f1f1;\n  }\n\n  .controls__container {\n    max-width: 48rem;\n    width: calc(100% - 2rem);\n    margin: 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n</style>\n\n<section class=\"controls\">\n  <div class=\"controls__container\">\n    <Button\n      label=\"Backward\"\n      {disabled}\n      icon={BackwardIcon}\n      on:click={onBackward} />\n\n    <Button\n      primary\n      {disabled}\n      label={playing ? 'Pause' : 'Play'}\n      icon={playing ? PauseIcon : PlayIcon}\n      on:click={onPlayToggle} />\n\n    <Button\n      {disabled}\n      icon={ForwardIcon}\n      on:click={onForward}\n      label=\"Forward\" />\n  </div>\n</section>\n"
  ],
  "names": [],
  "mappings": "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"
}